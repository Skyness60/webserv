<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Britify - Your Britney Playlist</title>
    <link rel="stylesheet" href="./style_playlist.css">
</head>
<body>
    <div class="glitter" id="glitter"></div>
    <div class="container">
        <h1>
            <span>B</span>
            <span>R</span>
            <span>I</span>
            <span>T</span>
            <span>I</span>
            <span>F</span>
            <span>Y</span>
            <span>‚ú®</span>
        </h1>
        
        <div class="playlist-management">
            <div class="playlist-actions">
                <button id="savePlaylistBtn" class="btn btn--small">Save Playlist</button>
                <button id="showPlaylistBtn" class="btn btn--small">Show Playlist</button>
                <button id="deletePlaylistBtn" class="btn btn--small">Delete Playlist</button>
            </div>
        </div>
        
        <div class="input-container">
            <select id="songInput">
                <option value="">Select a Britney song or type your own</option>
                <option value="...Baby One More Time">...Baby One More Time</option>
                <option value="Oops!...I Did It Again">Oops!...I Did It Again</option>
                <option value="Toxic">Toxic</option>
                <option value="Gimme More">Gimme More</option>
                <option value="Womanizer">Womanizer</option>
                <option value="Circus">Circus</option>
                <option value="I'm a Slave 4 U">I'm a Slave 4 U</option>
                <option value="Everytime">Everytime</option>
                <option value="Me Against the Music">Me Against the Music</option>
                <option value="Piece of Me">Piece of Me</option>
                <option value="Lucky">Lucky</option>
                <option value="Stronger">Stronger</option>
                <option value="Sometimes">Sometimes</option>
                <option value="Break the Ice">Break the Ice</option>
                <option value="If U Seek Amy">If U Seek Amy</option>
                <option value="Born to Make You Happy">Born to Make You Happy</option>
                <option value="Till the World Ends">Till the World Ends</option>
                <option value="Hold It Against Me">Hold It Against Me</option>
                <option value="Work Bitch">Work Bitch</option>
                <option value="custom">Enter my own...</option>
            </select>
            <input type="text" id="customSongInput" placeholder="Or type your own Britney song" style="display:none;">
            <button id="addBtn">Add to Playlist <span class="emoji">üéµ</span></button>
        </div>
        
        <div class="playlist-container">
            <div class="playlist-header">
                <div class="playlist-title">My Britney Playlist <span class="emoji">üíÉ</span></div>
                <button id="clearBtn">Clear All <span class="emoji">üóëÔ∏è</span></button>
            </div>
            <div class="songs-container" id="songsContainer">
                <div class="empty-message">
                    Your playlist is empty. Add up to 5 Britney songs!
                </div>
            </div>
        </div>
        
        <div class="footer">
            Hit me baby one more time! <span class="emoji">üé§</span>
        </div>
        
        <a href="/index.html" class="home-button">Back Home</a>
    </div>

    <div id="statusMessage" class="status-message"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const songSelect = document.getElementById('songInput');
            const customSongInput = document.getElementById('customSongInput');
            const addButton = document.getElementById('addBtn');
            const clearButton = document.getElementById('clearBtn');
            const songsContainer = document.getElementById('songsContainer');
            const glitterContainer = document.getElementById('glitter');
            const statusMessage = document.getElementById('statusMessage');
            const savePlaylistBtn = document.getElementById('savePlaylistBtn');
            const showPlaylistBtn = document.getElementById('showPlaylistBtn');
            const deletePlaylistBtn = document.getElementById('deletePlaylistBtn');
            
            // Single playlist ID
            const PLAYLIST_ID = 'britney_playlist';
            
            // Create glitter particles
            for (let i = 0; i < 50; i++) {
                createGlitterParticle();
            }
            
            // Load the playlist
            loadPlaylist(PLAYLIST_ID);
            
            // Event Listeners
            songSelect.addEventListener('change', function() {
                if (songSelect.value === 'custom') {
                    customSongInput.style.display = 'block';
                    songSelect.style.display = 'none';
                }
            });
            
            addButton.addEventListener('click', addSong);
            clearButton.addEventListener('click', clearPlaylist);
            
            savePlaylistBtn.addEventListener('click', function() {
                savePlaylistToFile(PLAYLIST_ID);
            });
            
            showPlaylistBtn.addEventListener('click', function() {
                showPlaylistContents();
            });
            
            deletePlaylistBtn.addEventListener('click', function() {
                deletePlaylistFile(PLAYLIST_ID);
            });
            
            // Functions
            function addSong() {
                // Check if we already have 5 songs
                const currentSongs = document.querySelectorAll('.song-item');
                if (currentSongs.length >= 5) {
                    showStatus('You can only add up to 5 songs to your playlist!', 'error');
                    return;
                }
                
                // Get the song value
                let songValue = songSelect.value;
                if (customSongInput.style.display === 'block') {
                    songValue = customSongInput.value;
                    // Reset to select after adding
                    customSongInput.value = '';
                    customSongInput.style.display = 'none';
                    songSelect.style.display = 'block';
                    songSelect.value = '';
                }
                
                // Validate input
                if (!songValue) {
                    showStatus('Please select or enter a Britney song!', 'error');
                    return;
                }
                
                // Create and add song item
                const songItem = createSongElement(songValue);
                
                // Remove empty message if it exists
                const emptyMessage = document.querySelector('.empty-message');
                if (emptyMessage) {
                    emptyMessage.remove();
                }
                
                songsContainer.appendChild(songItem);
                
                // Save playlist to localStorage
                savePlaylist(PLAYLIST_ID);
                showStatus(`"${songValue}" added to your playlist! üéµ`, 'success');
            }
            
            function createSongElement(songName) {
                const songItem = document.createElement('div');
                songItem.className = 'song-item';
                songItem.draggable = true;
                
                const songTitle = document.createElement('div');
                songTitle.className = 'song-title';
                songTitle.innerHTML = `<span class="emoji">üéµ</span> ${songName}`;
                
                const songControls = document.createElement('div');
                songControls.className = 'song-controls';
                
                const moveUpBtn = document.createElement('button');
                moveUpBtn.innerHTML = '‚¨ÜÔ∏è';
                moveUpBtn.title = 'Move Up';
                moveUpBtn.addEventListener('click', () => moveSong(songItem, 'up'));
                
                const moveDownBtn = document.createElement('button');
                moveDownBtn.innerHTML = '‚¨áÔ∏è';
                moveDownBtn.title = 'Move Down';
                moveDownBtn.addEventListener('click', () => moveSong(songItem, 'down'));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '‚ùå';
                deleteBtn.title = 'Remove Song';
                deleteBtn.addEventListener('click', () => {
                    const songText = songItem.querySelector('.song-title').textContent.replace('üéµ ', '');
                    songItem.remove();
                    
                    // If no songs left, add empty message
                    if (songsContainer.children.length === 0) {
                        const emptyMessage = document.createElement('div');
                        emptyMessage.className = 'empty-message';
                        emptyMessage.textContent = 'Your playlist is empty. Add up to 5 Britney songs!';
                        songsContainer.appendChild(emptyMessage);
                    }
                    
                    // Save playlist to localStorage
                    savePlaylist(PLAYLIST_ID);
                    showStatus(`"${songText}" removed from your playlist`, 'info');
                });
                
                songControls.appendChild(moveUpBtn);
                songControls.appendChild(moveDownBtn);
                songControls.appendChild(deleteBtn);
                
                songItem.appendChild(songTitle);
                songItem.appendChild(songControls);
                
                // Drag and drop functionality
                songItem.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', songName);
                    this.classList.add('dragging');
                });
                
                songItem.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });
                
                songItem.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });
                
                songItem.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });
                
                songItem.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    const draggedSongName = e.dataTransfer.getData('text/plain');
                    const draggedItem = Array.from(songsContainer.children).find(
                        item => item.querySelector('.song-title').textContent.includes(draggedSongName)
                    );
                    
                    if (draggedItem && draggedItem !== this) {
                        const rect = this.getBoundingClientRect();
                        const y = e.clientY - rect.top;
                        const height = this.offsetHeight;
                        
                        if (y < height / 2) {
                            songsContainer.insertBefore(draggedItem, this);
                        } else {
                            songsContainer.insertBefore(draggedItem, this.nextSibling);
                        }
                                 // Save playlist to localStorage
                savePlaylist(PLAYLIST_ID);
                showStatus('Playlist order updated! ‚ú®', 'info');
                    }
                });
                
                return songItem;
            }
            
            function moveSong(songItem, direction) {
                if (direction === 'up' && songItem.previousElementSibling && !songItem.previousElementSibling.classList.contains('empty-message')) {
                    songsContainer.insertBefore(songItem, songItem.previousElementSibling);
                    showStatus('Song moved up! ‚¨ÜÔ∏è', 'info');
                } else if (direction === 'down' && songItem.nextElementSibling) {
                    songsContainer.insertBefore(songItem.nextElementSibling, songItem);
                    showStatus('Song moved down! ‚¨áÔ∏è', 'info');
                }
                // Save playlist to localStorage
                savePlaylist(PLAYLIST_ID);
            }
            
            function clearPlaylist() {
                if (confirm('Are you sure you want to clear your playlist?')) {
                    songsContainer.innerHTML = '';
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'empty-message';
                    emptyMessage.textContent = 'Your playlist is empty. Add up to 5 Britney songs!';
                    songsContainer.appendChild(emptyMessage);
                    
                    // Delete playlist from localStorage
                    deletePlaylist(PLAYLIST_ID);
                    showStatus('Playlist cleared! üóëÔ∏è', 'warning');
                }
            }
            
            function createGlitterParticle() {
                const particle = document.createElement('div');
                particle.className = 'glitter-particle';
                
                // Random position and animation delay
                const posX = Math.random() * 100;
                particle.style.left = `${posX}%`;
                particle.style.top = `-5px`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                
                glitterContainer.appendChild(particle);
                
                // Remove and recreate particle after animation
                setTimeout(() => {
                    particle.remove();
                    createGlitterParticle();
                }, 3000 + (Math.random() * 2000));
            }
            
            // Show status message function
            function showStatus(message, type = 'info') {
                statusMessage.textContent = message;
                
                // Set color based on message type
                if (type === 'error') {
                    statusMessage.style.backgroundColor = 'rgba(220, 53, 69, 0.9)';
                } else if (type === 'success') {
                    statusMessage.style.backgroundColor = 'rgba(40, 167, 69, 0.9)';
                } else if (type === 'warning') {
                    statusMessage.style.backgroundColor = 'rgba(255, 193, 7, 0.9)';
                } else {
                    statusMessage.style.backgroundColor = 'rgba(255, 102, 196, 0.9)';
                }
                
                statusMessage.classList.add('show');
                
                setTimeout(() => {
                    statusMessage.classList.remove('show');
                }, 3000);
            }
            
            // Show playlist contents in a nice format
            function showPlaylistContents() {
                const songs = Array.from(document.querySelectorAll('.song-item')).map(
                    item => item.querySelector('.song-title').textContent.replace('üéµ ', '')
                );
                
                if (songs.length === 0) {
                    showStatus('Your playlist is empty!', 'info');
                    return;
                }
                
                const songList = songs.map((song, index) => `${index + 1}. ${song}`).join('\n');
                alert(`Your Britney Playlist:\n\n${songList}`);
            }
            
            // localStorage-based playlist management functions
            function savePlaylist(playlistId) {
                const songs = Array.from(document.querySelectorAll('.song-item')).map(
                    item => item.querySelector('.song-title').textContent.replace('üéµ ', '')
                );
                
                const playlistData = {
                    name: "My Britney Playlist",
                    songs: songs
                };
                
                try {
                    // Save to localStorage
                    localStorage.setItem(playlistId, JSON.stringify(playlistData));
                    console.log(`Playlist saved to localStorage: ${playlistId}`, playlistData);
                } catch (error) {
                    console.error('Error saving playlist to localStorage:', error);
                    showStatus('Error saving playlist!', 'error');
                }
            }
            
            function loadPlaylist(playlistId) {
                try {
                    // Load from localStorage
                    const savedPlaylist = localStorage.getItem(playlistId);
                    
                    // Clear current playlist display
                    songsContainer.innerHTML = '';
                    
                    if (savedPlaylist) {
                        const data = JSON.parse(savedPlaylist);
                        
                        if (data && data.songs && data.songs.length > 0) {
                            // Add songs to the UI
                            data.songs.forEach(song => {
                                const songItem = createSongElement(song);
                                songsContainer.appendChild(songItem);
                            });
                            
                            console.log(`Playlist loaded from localStorage: ${playlistId}`, data);
                        } else {
                            // Empty playlist
                            const emptyMessage = document.createElement('div');
                            emptyMessage.className = 'empty-message';
                            emptyMessage.textContent = 'Your playlist is empty. Add up to 5 Britney songs!';
                            songsContainer.appendChild(emptyMessage);
                        }
                    } else {
                        // No playlist saved yet
                        const emptyMessage = document.createElement('div');
                        emptyMessage.className = 'empty-message';
                        emptyMessage.textContent = 'Your playlist is empty. Add up to 5 Britney songs!';
                        songsContainer.appendChild(emptyMessage);
                    }
                } catch (error) {
                    console.error('Error loading playlist from localStorage:', error);
                    showStatus('Error loading playlist!', 'error');
                    
                    // Display empty message on error
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'empty-message';
                    emptyMessage.textContent = 'Your playlist is empty. Add up to 5 Britney songs!';
                    songsContainer.appendChild(emptyMessage);
                }
            }
            
            function deletePlaylist(playlistId) {
                try {
                    // Remove from localStorage
                    localStorage.removeItem(playlistId);
                    console.log(`Playlist deleted from localStorage: ${playlistId}`);
                } catch (error) {
                    console.error('Error deleting playlist from localStorage:', error);
                    showStatus('Error deleting playlist!', 'error');
                }
            }
            
            // Save playlist to a JSON file on the server
            function savePlaylistToFile(playlistId) {
                try {
                    // Get the current playlist data
                    const playlistData = JSON.parse(localStorage.getItem(playlistId) || '{"name":"My Britney Playlist","songs":[]}');
                    
                    // Update timestamp
                    playlistData.createdAt = new Date().toISOString();
                    
                    // Save to localStorage (we're already doing this in savePlaylist())
                    localStorage.setItem(playlistId, JSON.stringify(playlistData));
                    
                    // Since we don't have PHP, we'll simulate a successful server save
                    showStatus('Playlist saved successfully! üíæ', 'success');
                    
                    // For debugging - show in console what would be sent to server
                    console.log('Playlist saved (client-side only):', playlistData);
                } catch (err) {
                    console.error('Error saving playlist:', err);
                    showStatus('Error saving playlist! Please try again. üòû', 'error');
                }
            }
            
            // Delete playlist file from server
            function deletePlaylistFile(playlistId) {
                try {
                    // Just delete from localStorage
                    localStorage.removeItem(playlistId);
                    
                    // Clear the display
                    songsContainer.innerHTML = '<div class="empty-message">Your playlist is empty. Add some Britney songs! üíÉ</div>';
                    
                    showStatus('Playlist deleted successfully! üóëÔ∏è', 'success');
                } catch (err) {
                    console.error('Error deleting playlist:', err);
                    showStatus('Error deleting playlist! Please try again. üòû', 'error');
                }
            }
        });
    </script>
</body>
</html>
